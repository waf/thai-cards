(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var type;try{type=require("type-of")}catch(ex){var r=require;type=r("type")}var jsonpID=0,document=window.document,key,name,rscript=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,scriptTypeRE=/^(?:text|application)\/javascript/i,xmlTypeRE=/^(?:text|application)\/xml/i,jsonType="application/json",htmlType="text/html",blankRE=/^\s*$/;var ajax=module.exports=function(options){var settings=extend({},options||{});for(key in ajax.settings)if(settings[key]===undefined)settings[key]=ajax.settings[key];ajaxStart(settings);if(!settings.crossDomain)settings.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(settings.url)&&RegExp.$2!=window.location.host;var dataType=settings.dataType,hasPlaceholder=/=\?/.test(settings.url);if(dataType=="jsonp"||hasPlaceholder){if(!hasPlaceholder)settings.url=appendQuery(settings.url,"callback=?");return ajax.JSONP(settings)}if(!settings.url)settings.url=window.location.toString();serializeData(settings);var mime=settings.accepts[dataType],baseHeaders={},protocol=/^([\w-]+:)\/\//.test(settings.url)?RegExp.$1:window.location.protocol,xhr=ajax.settings.xhr(),abortTimeout;if(!settings.crossDomain)baseHeaders["X-Requested-With"]="XMLHttpRequest";if(mime){baseHeaders["Accept"]=mime;if(mime.indexOf(",")>-1)mime=mime.split(",",2)[0];xhr.overrideMimeType&&xhr.overrideMimeType(mime)}if(settings.contentType||settings.data&&settings.type.toUpperCase()!="GET")baseHeaders["Content-Type"]=settings.contentType||"application/x-www-form-urlencoded";settings.headers=extend(baseHeaders,settings.headers||{});xhr.onreadystatechange=function(){if(xhr.readyState==4){clearTimeout(abortTimeout);var result,error=false;if(xhr.status>=200&&xhr.status<300||xhr.status==304||xhr.status==0&&protocol=="file:"){dataType=dataType||mimeToDataType(xhr.getResponseHeader("content-type"));result=xhr.responseText;try{if(dataType=="script")(1,eval)(result);else if(dataType=="xml")result=xhr.responseXML;else if(dataType=="json")result=blankRE.test(result)?null:JSON.parse(result)}catch(e){error=e}if(error)ajaxError(error,"parsererror",xhr,settings);else ajaxSuccess(result,xhr,settings)}else{ajaxError(null,"error",xhr,settings)}}};var async="async"in settings?settings.async:true;xhr.open(settings.type,settings.url,async);for(name in settings.headers)xhr.setRequestHeader(name,settings.headers[name]);if(ajaxBeforeSend(xhr,settings)===false){xhr.abort();return false}if(settings.timeout>0)abortTimeout=setTimeout(function(){xhr.onreadystatechange=empty;xhr.abort();ajaxError(null,"timeout",xhr,settings)},settings.timeout);xhr.send(settings.data?settings.data:null);return xhr};function triggerAndReturn(context,eventName,data){return true}function triggerGlobal(settings,context,eventName,data){if(settings.global)return triggerAndReturn(context||document,eventName,data)}ajax.active=0;function ajaxStart(settings){if(settings.global&&ajax.active++===0)triggerGlobal(settings,null,"ajaxStart")}function ajaxStop(settings){if(settings.global&&!--ajax.active)triggerGlobal(settings,null,"ajaxStop")}function ajaxBeforeSend(xhr,settings){var context=settings.context;if(settings.beforeSend.call(context,xhr,settings)===false||triggerGlobal(settings,context,"ajaxBeforeSend",[xhr,settings])===false)return false;triggerGlobal(settings,context,"ajaxSend",[xhr,settings])}function ajaxSuccess(data,xhr,settings){var context=settings.context,status="success";settings.success.call(context,data,status,xhr);triggerGlobal(settings,context,"ajaxSuccess",[xhr,settings,data]);ajaxComplete(status,xhr,settings)}function ajaxError(error,type,xhr,settings){var context=settings.context;settings.error.call(context,xhr,type,error);triggerGlobal(settings,context,"ajaxError",[xhr,settings,error]);ajaxComplete(type,xhr,settings)}function ajaxComplete(status,xhr,settings){var context=settings.context;settings.complete.call(context,xhr,status);triggerGlobal(settings,context,"ajaxComplete",[xhr,settings]);ajaxStop(settings)}function empty(){}ajax.JSONP=function(options){if(!("type"in options))return ajax(options);var callbackName="jsonp"+ ++jsonpID,script=document.createElement("script"),abort=function(){if(callbackName in window)window[callbackName]=empty;ajaxComplete("abort",xhr,options)},xhr={abort:abort},abortTimeout,head=document.getElementsByTagName("head")[0]||document.documentElement;if(options.error)script.onerror=function(){xhr.abort();options.error()};window[callbackName]=function(data){clearTimeout(abortTimeout);delete window[callbackName];ajaxSuccess(data,xhr,options)};serializeData(options);script.src=options.url.replace(/=\?/,"="+callbackName);head.insertBefore(script,head.firstChild);if(options.timeout>0)abortTimeout=setTimeout(function(){xhr.abort();ajaxComplete("timeout",xhr,options)},options.timeout);return xhr};ajax.settings={type:"GET",beforeSend:empty,success:empty,error:empty,complete:empty,context:null,global:true,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:jsonType,xml:"application/xml, text/xml",html:htmlType,text:"text/plain"},crossDomain:false,timeout:0};function mimeToDataType(mime){return mime&&(mime==htmlType?"html":mime==jsonType?"json":scriptTypeRE.test(mime)?"script":xmlTypeRE.test(mime)&&"xml")||"text"}function appendQuery(url,query){return(url+"&"+query).replace(/[&?]{1,2}/,"?")}function serializeData(options){if(type(options.data)==="object")options.data=param(options.data);if(options.data&&(!options.type||options.type.toUpperCase()=="GET"))options.url=appendQuery(options.url,options.data)}ajax.get=function(url,success){return ajax({url:url,success:success})};ajax.post=function(url,data,success,dataType){if(type(data)==="function")dataType=dataType||success,success=data,data=null;return ajax({type:"POST",url:url,data:data,success:success,dataType:dataType})};ajax.getJSON=function(url,success){return ajax({url:url,success:success,dataType:"json"})};var escape=encodeURIComponent;function serialize(params,obj,traditional,scope){var array=type(obj)==="array";for(var key in obj){var value=obj[key];if(scope)key=traditional?scope:scope+"["+(array?"":key)+"]";if(!scope&&array)params.add(value.name,value.value);else if(traditional?type(value)==="array":type(value)==="object")serialize(params,value,traditional,key);else params.add(key,value)}}function param(obj,traditional){var params=[];params.add=function(k,v){this.push(escape(k)+"="+escape(v))};serialize(params,obj,traditional);return params.join("&").replace("%20","+")}function extend(target){var slice=Array.prototype.slice;slice.call(arguments,1).forEach(function(source){for(key in source)if(source[key]!==undefined)target[key]=source[key]});return target}},{"type-of":2}],2:[function(require,module,exports){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}if(val===null)return"null";if(val===undefined)return"undefined";if(val&&val.nodeType===1)return"element";if(val===Object(val))return"object";return typeof val}},{}]},{},[1]);(function(a){function b(){this._callbacks=[]}b.prototype.then=function(a,c){var d;if(this._isdone)d=a.apply(c,this.result);else{d=new b;this._callbacks.push(function(){var b=a.apply(c,arguments);if(b&&typeof b.then==="function")b.then(d.done,d)})}return d};b.prototype.done=function(){this.result=arguments;this._isdone=true;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[]};function c(a){var c=new b;var d=[];if(!a||!a.length){c.done(d);return c}var e=0;var f=a.length;function g(a){return function(){e+=1;d[a]=Array.prototype.slice.call(arguments);if(e===f)c.done(d)}}for(var h=0;h<f;h++)a[h].then(g(h));return c}function d(a,c){var e=new b;if(a.length===0)e.done.apply(e,c);else a[0].apply(null,c).then(function(){a.splice(0,1);d(a,arguments).then(function(){e.done.apply(e,arguments)})});return e}function e(a){var b="";if(typeof a==="string")b=a;else{var c=encodeURIComponent;for(var d in a)if(a.hasOwnProperty(d))b+="&"+c(d)+"="+c(a[d])}return b}function f(){var a;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}return a}function g(a,c,d,g){var h=new b;var j,k;d=d||{};g=g||{};try{j=f()}catch(l){h.done(i.ENOXHR,"");return h}k=e(d);if(a==="GET"&&k){c+="?"+k;k=null}j.open(a,c);j.setRequestHeader("Content-type","application/x-www-form-urlencoded");for(var m in g)if(g.hasOwnProperty(m))j.setRequestHeader(m,g[m]);function n(){j.abort();h.done(i.ETIMEOUT,"",j)}var o=i.ajaxTimeout;if(o)var p=setTimeout(n,o);j.onreadystatechange=function(){if(o)clearTimeout(p);if(j.readyState===4){var a=!j.status||(j.status<200||j.status>=300)&&j.status!==304;h.done(a,j.responseText,j)}};j.send(k);return h}function h(a){return function(b,c,d){return g(a,b,c,d)}}var i={Promise:b,join:c,chain:d,ajax:g,get:h("GET"),post:h("POST"),put:h("PUT"),del:h("DELETE"),ENOXHR:1,ETIMEOUT:2,ajaxTimeout:0};if(typeof define==="function"&&define.amd)define(function(){return i});else a.promise=i})(this);util={inPlaceShuffle:function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array},loadModules:function(url,callback){promise.get(url).then(function(err,json){var moduleList=JSON.parse(json);var moduleRequests=moduleList.map(function(m){var filename="./modules/"+m+".js";return promise.get(filename)});promise.join(moduleRequests).then(function(responses){var modules={};for(var i=0;i<moduleList.length;i++){var moduleName=moduleList[i];var error=responses[i][0];var json=responses[i][1];if(!error){modules[moduleName]=JSON.parse(json)}}callback(modules)})})},shuffleCardsFromModules:function(modules,activeModules){var cards=[];for(var name in modules){if(activeModules.indexOf(name)>=0){cards=cards.concat(modules[name])}}this.inPlaceShuffle(cards);return cards},fitWordToWidth:function(element,adjustmentRatio){adjustmentRatio=adjustmentRatio||1;element.style.fontSize="40px";var fontBase=window.innerWidth/element.offsetWidth*30;var min=40;var max=130;var fontSize=fontBase>max?max:fontBase<min?min:fontBase;return fontSize*adjustmentRatio},readFormChangeFromEvent:function(e){var formChange={};var name=e.target.name;if(e.target.nodeName==="SELECT"){formChange[name]=[];for(var key in e.target.options){var opt=e.target.options[key];if(opt.selected){formChange[name].push(opt.value)}}}else if(e.target.nodeName==="INPUT"&&e.target.type==="checkbox"){formChange[name]=e.target.checked}else{formChange[name]=e.target.value}return formChange}};var Settings=React.createClass({displayName:"Settings",getInitialState:function(){if(localStorage.settings){return JSON.parse(localStorage.settings)}return{font:"traditional",activeModules:Object.keys(this.props.allModules),mode:"thai-prompt",starMode:false,clearStars:false}},componentDidUpdate:function(){localStorage.settings=JSON.stringify(this.state)},componentDidMount:function(){this.props.onSettingChanged(this.state)},formElementChanged:function(e){var changeSet=util.readFormChangeFromEvent(e);this.setState(changeSet);this.props.onSettingChanged(changeSet)},clearStars:function(e){this.props.onSettingChanged({clearStars:true});this.setState({starMode:false})},render:function(){var options=[];for(var key in this.props.allModules){options.push(React.createElement("option",{key:key,value:key},key))}options.sort(function(o1,o2){return o1.key>o2.key});return React.createElement("div",{id:"settings",onChange:this.formElementChanged},React.createElement("a",{className:"close",href:"#"},"X"),React.createElement("div",{className:"right-column"},React.createElement("h1",null,"Starred Cards"),React.createElement("label",null,React.createElement("input",{onChange:this.formElementChanged,type:"checkbox",name:"starMode",checked:this.state.starMode}),"Show only starred cards"),React.createElement("button",{name:"clearStars",onClick:this.clearStars},"Clear all starred cards"),React.createElement("h1",null,"Card Topics"),React.createElement("select",{name:"activeModules",multiple:true,value:this.state.activeModules,size:"6"},options)),React.createElement("div",{className:"left-column"},React.createElement("h1",null,"Mode"),React.createElement("label",null,React.createElement("input",{type:"radio",name:"mode",value:"thai-prompt",defaultChecked:this.state.mode==="thai-prompt"})," Thai → English"),React.createElement("label",null,React.createElement("input",{type:"radio",name:"mode",value:"english-prompt",defaultChecked:this.state.mode==="english-prompt"})," English → Thai"),React.createElement("h1",null,"Thai Font"),React.createElement("label",null,React.createElement("input",{type:"radio",name:"font",value:"traditional",defaultChecked:this.state.font==="traditional"}),"Traditional"),React.createElement("label",null,React.createElement("input",{type:"radio",name:"font",value:"modern",defaultChecked:this.state.font==="modern"}),"Modern")))}});var Card=React.createClass({displayName:"Card",adjustFontSizes:function(){var thai=this.refs.thai.getDOMNode();var english=this.refs.english.getDOMNode();thai.style.fontSize=util.fitWordToWidth(thai,1)+"px";english.style.fontSize=util.fitWordToWidth(english,.8)+"px"},componentDidUpdate:function(){this.adjustFontSizes()},componentDidMount:function(){this.adjustFontSizes()},render:function(){var cardClass="card"+(this.props.flipped?" flipped":"");return React.createElement("div",{className:cardClass},React.createElement("a",{href:"#",className:"card-text",onClick:this.props.onClick},React.createElement("span",{ref:"thai",className:"thai"},this.props.card.thai),React.createElement("span",{ref:"english",className:"english"},this.props.card.english)))}});var Deck=React.createClass({displayName:"Deck",getInitialState:function(){return{cardIndex:0,flippedCard:false}},componentWillReceiveProps:function(nextProps){if(nextProps.cards.length!==this.props.cards.length){this.setState({cardIndex:0})}},prevCard:function(e){e.preventDefault();this.setState({flipped:false,cardIndex:Math.max(0,this.state.cardIndex-1)})},nextCard:function(e){e.preventDefault();var nextIndex=this.state.cardIndex+1;if(nextIndex===this.props.cards.length){this.props.onDeckFinished();nextIndex=0}this.setState({flipped:false,cardIndex:nextIndex})},flipCard:function(e){e.preventDefault();this.setState({flipped:!this.state.flipped})},starCard:function(e){e.preventDefault();this.props.onCardStarred(this.props.cards[this.state.cardIndex])},render:function(){var card=this.props.cards[this.state.cardIndex];if(card){var starClass="star-btn"+(card.starred?" starred":"");var translateLink="http://translate.google.com/#th/en/"+card.thai;var cardUI=React.createElement("div",null,React.createElement(Card,{card:card,onClick:this.flipCard,flipped:this.state.flipped}),React.createElement("a",{className:"nav-btn back",href:"#",onClick:this.prevCard},React.createElement("span",null,"◀")),React.createElement("a",{className:"nav-btn next",href:"#",onClick:this.nextCard},React.createElement("span",null,"▶")))}else{var cardUI=React.createElement("p",{style:{textAlign:"center"}},"No topics are selected. Please select at least one topic from the Settings menu.")}return React.createElement("div",{className:"deck"},React.createElement("div",{className:"action-bar"},React.createElement("a",{target:"_blank",href:translateLink},"google"),React.createElement("a",{className:starClass,href:"#",onClick:this.starCard},"★"),React.createElement("a",{href:"#settings"},"settings")),cardUI)}});var Game=React.createClass({displayName:"Game",getInitialState:function(){var starCards=window.localStorage.starCards?JSON.parse(window.localStorage.starCards):[];return{allModules:{},activeModules:[],starCards:starCards,starMode:false,cards:[]}},onSettingChanged:function(changeSet){var root=document.getElementById("game");if("font"in changeSet)root.dataset.font=changeSet.font;if("mode"in changeSet)root.dataset.mode=changeSet.mode;if("activeModules"in changeSet){var cards=util.shuffleCardsFromModules(this.state.allModules,changeSet.activeModules);this.setState({activeModules:changeSet.activeModules,cards:cards})}if("clearStars"in changeSet)this.setState({starCards:[]});if("starMode"in changeSet)this.setState({starMode:changeSet.starMode})},onDeckFinished:function(){var cards=util.shuffleCardsFromModules(this.state.allModules,this.state.activeModules);this.setState({cards:cards})},componentDidMount:function(){var self=this;util.loadModules("./modules.json",function(allModules){self.setState({allModules:allModules})})},onCardStarred:function(card){var index=this.state.starCards.indexOf(card.thai);if(index===-1){var starCards=this.state.starCards.concat([card.thai])}else{var starCards=this.state.starCards.filter(function(c){return c!==card.thai})}this.setState({starCards:starCards},function(){window.localStorage.starCards=JSON.stringify(starCards)})},render:function(){var deck=this.state.cards;for(var i in deck){deck[i].starred=this.state.starCards.indexOf(deck[i].thai)>=0}if(this.state.starMode){deck=deck.filter(function(card){return card.starred});if(deck.length===0){deck=this.state.cards}}return React.createElement("div",{id:"game"},React.createElement(Settings,{allModules:this.state.allModules,onSettingChanged:this.onSettingChanged}),React.createElement(Deck,{cards:deck,onCardStarred:this.onCardStarred,onDeckFinished:this.onDeckFinished}))}});React.initializeTouchEvents(true);React.render(React.createElement(Game,null),document.body);